<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>달력</title>
  <style>
    body {
      font-family: sans-serif;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
      margin: auto;
    }
    th, td {
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
      padding: 5px;
      height: 100px;
    }
    th {
      background: #f0f0f0;
    }
    .sunday {
      color: red;
    }
    .holiday-name {
      color: red;
      font-weight: bold;
    }
    .memo {
      display: block;
      margin-top: 5px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;" id="calendar-title">로딩 중...</h1>
  <table id="calendar"></table>

  <script>
    const API_KEY = '8JrZ7bV8ldqfBkPw2jiJG8RBfL559YI/k2FYcNRGLUiIE9XSl7Oae+eLSnTOmotMf35yk8pBsSIB0NWvhoJOaw==';
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;

    const memoData = {
      '2025-07-25': '메모 테스트입니다.\n두 번째 줄입니다.',
      '2025-08-15': '광복절과 관련된 메모입니다.',
    };

    const calendarTitle = document.getElementById("calendar-title");
    const calendar = document.getElementById("calendar");

    function pad(n) {
      return n < 10 ? '0' + n : n;
    }

    async function fetchHolidays(year, month) {
      const targetMonth = pad(month);
      const url = `https://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo?ServiceKey=${API_KEY}&solYear=${year}&solMonth=${targetMonth}&_type=json`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const items = data.response.body.items?.item || [];
        const holidays = {};
        for (const item of Array.isArray(items) ? items : [items]) {
          holidays[item.locdate.toString().replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')] = item.dateName;
        }
        return holidays;
      } catch (e) {
        console.error("공휴일 데이터를 불러오는 중 오류 발생:", e);
        return {};
      }
    }

    function generateCalendar(year, month, holidays) {
      const firstDay = new Date(year, month - 1, 1);
      const lastDay = new Date(year, month, 0);
      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();

      calendarTitle.textContent = `${year}년 ${month}월`;

      const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
      let html = '<tr>' + weekdays.map((d, i) => `<th class="${i === 0 ? 'sunday' : ''}">${d}</th>`).join('') + '</tr>';

      let date = 1;
      for (let i = 0; i < 6; i++) {
        html += '<tr>';
        for (let j = 0; j < 7; j++) {
          if (i === 0 && j < startDay) {
            html += '<td></td>';
          } else if (date > totalDays) {
            html += '<td></td>';
          } else {
            const fullDate = `${year}-${pad(month)}-${pad(date)}`;
            const isSunday = j === 0;
            const holidayName = holidays[fullDate];
            const memo = memoData[fullDate] || '';

            html += `<td${isSunday || holidayName ? ' class="sunday"' : ''}>`;

            if (holidayName) {
              html += `<div class="holiday-name">${holidayName}</div>`;
              if (memo) html += `<div class="memo">${memo}</div>`;
            } else {
              html += `<strong>${date}</strong>`;
              if (memo) html += `<div class="memo">${memo}</div>`;
            }

            html += '</td>';
            date++;
          }
        }
        html += '</tr>';
        if (date > totalDays) break;
      }

      calendar.innerHTML = html;
    }

    (async () => {
      const holidays = await fetchHolidays(year, month);
      generateCalendar(year, month, holidays);
    })();
  </script>
</body>
</html>